<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D365 Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script>
    async function copyText(text){
        try{ await navigator.clipboard.writeText(text); toast('Copied'); }catch(e){ console.error(e); }
    }
    async function copyToClipboard(text){
        try{ await navigator.clipboard.writeText(text); toast('Copied to clipboard'); }catch(e){ console.error(e); }
    }
    
    function draftPrecutEmail() {
        const jobNumber = document.querySelector('input[name="job_number"]').value;
        if (!jobNumber) {
            toast('Please enter a Job Number first', 'error');
            return;
        }
        
        const selectedSections = getSelectedSections();
        if (selectedSections.length === 0) {
            toast('Please select at least one section', 'error');
            return;
        }
        
        let precutItems = [];
        
        // Collect PRECUT items only from selected sections
        const sectionTableMap = {
            'heater': 'heater-table',
            'tank': 'tank-table',
            'pump': 'pump-table'
        };
        
        selectedSections.forEach(section => {
            const tableId = sectionTableMap[section];
            const table = document.getElementById(tableId);
            if (table) {
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const descriptionButton = row.cells[1].querySelector('button');
                    const itemNumberButton = row.cells[0].querySelector('button');
                    
                    if (descriptionButton && itemNumberButton) {
                        const description = descriptionButton.textContent.trim();
                        const itemNumber = itemNumberButton.textContent.trim();
                        
                        if (description.includes('PRECUT')) {
                            precutItems.push(`${itemNumber}\t${description}`);
                        }
                    }
                });
            }
        });
        
        if (precutItems.length === 0) {
            toast('No PRECUT items found in selected sections', 'info');
            return;
        }
        
        // Build email content
        const subject = `NEW P/N REQUEST for Job: ${jobNumber}`;
        const body = [
            `Hi George, Can you setup P/Ns for Job: ${jobNumber}`,
            '',
            ...precutItems,
            '',
            'Thanks so Much!!!!'
        ].join('\n');
        
        // Create mailto link
        const mailtoLink = `mailto:gemurphy@kemcosystems.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        
        // Open email client
        window.location.href = mailtoLink;
    }
    function copyRow(btn){
        const tr = btn.closest('tr');
        const cols = Array.from(tr.querySelectorAll('[data-copy]')).map(td=>td.textContent.trim());
        copyText(cols.join('\t'));
    }
    function copyAll(tableId){
        const rows = Array.from(document.querySelectorAll('#'+tableId+' tbody tr'));
        const lines = rows.map(tr=>Array.from(tr.querySelectorAll('[data-copy]')).map(td=>td.textContent.trim()).join('\t'));
        copyText(lines.join('\n'));
    }
    function toast(msg){
        const t = document.createElement('div');
        t.className='toast toast-top toast-end';
        t.innerHTML = `<div class="alert alert-success">${msg}</div>`;
        document.body.appendChild(t); setTimeout(()=>t.remove(),1200);
    }
    function submitGenerateAll(){
        const forms = Array.from(document.querySelectorAll('form'));
        const all = new FormData();
        const csrf = document.querySelector('input[name="csrfmiddlewaretoken"]');
        if(csrf){ all.append('csrfmiddlewaretoken', csrf.value); }
        all.append('generate_all','1');
        forms.forEach(f=>{
            new FormData(f).forEach((v,k)=>{
                if(k==='csrfmiddlewaretoken') return;
                if(v!==null && v!==undefined && v!=='') all.append(k,v);
            });
        });
        const tmp = document.createElement('form');
        tmp.method='POST';
        tmp.action='';
        for (const [k,v] of all.entries()){
            const i=document.createElement('input'); i.type='hidden'; i.name=k; i.value=v; tmp.appendChild(i);
        }
        document.body.appendChild(tmp); tmp.submit();
    }
    
    function submitGenerateSelected(){
        const selectedSections = getSelectedSections();
        if (selectedSections.length === 0) {
            toast('Please select at least one section', 'error');
            return;
        }
        
        const forms = Array.from(document.querySelectorAll('form'));
        const all = new FormData();
        const csrf = document.querySelector('input[name="csrfmiddlewaretoken"]');
        if(csrf){ all.append('csrfmiddlewaretoken', csrf.value); }
        all.append('generate_selected','1');
        all.append('selected_sections', selectedSections.join(','));
        
        forms.forEach(f=>{
            new FormData(f).forEach((v,k)=>{
                if(k==='csrfmiddlewaretoken') return;
                if(v!==null && v!==undefined && v!=='') all.append(k,v);
            });
        });
        const tmp = document.createElement('form');
        tmp.method='POST';
        tmp.action='';
        for (const [k,v] of all.entries()){
            const i=document.createElement('input'); i.type='hidden'; i.name=k; i.value=v; tmp.appendChild(i);
        }
        document.body.appendChild(tmp); tmp.submit();
    }
    
    function getSelectedSections(){
        const sections = [];
        if (document.getElementById('toggle_heater').checked) sections.push('heater');
        if (document.getElementById('toggle_tank').checked) sections.push('tank');
        if (document.getElementById('toggle_pump').checked) sections.push('pump');
        return sections;
    }
    
    function saveSelectedSections(){
        const selectedSections = getSelectedSections();
        // Save to session via AJAX
        fetch('/d365/save-selection/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({selected_sections: selectedSections})
        });
    }
    
    // Add event listeners to save state when checkboxes change
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('toggle_heater').addEventListener('change', saveSelectedSections);
        document.getElementById('toggle_tank').addEventListener('change', saveSelectedSections);
        document.getElementById('toggle_pump').addEventListener('change', saveSelectedSections);
    });
    
    function printSelectedSections(){
        const selectedSections = getSelectedSections();
        if (selectedSections.length === 0) {
            toast('Please select at least one section', 'error');
            return;
        }
        
        const jobNumber = document.querySelector('input[name="job_number"]').value;
        if (!jobNumber) {
            toast('Please enter a Job Number first', 'error');
            return;
        }
        
        const sectionsParam = selectedSections.join(',');
        window.open(`/d365/print/${jobNumber}/?sections=${sectionsParam}`, '_blank');
    }
    
    // Tab switching functionality
    function switchTab(tabIndex) {
        // Remove active class from all tabs
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('tab-active'));
        
        // Hide all tab panels
        document.querySelectorAll('.tab-content').forEach(panel => panel.style.display = 'none');
        
        // Activate selected tab
        const tabs = document.querySelectorAll('.tab');
        if (tabs[tabIndex]) {
            tabs[tabIndex].classList.add('tab-active');
        }
        
        // Show corresponding panel
        const panels = document.querySelectorAll('.tab-content');
        if (panels[tabIndex]) {
            panels[tabIndex].style.display = 'block';
        }
    }
    
    // Initialize tabs on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Set up click handlers for tabs
        document.querySelectorAll('.tab').forEach((tab, index) => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                switchTab(index);
            });
        });
        
        // Initialize with first tab active
        switchTab(0);
    });
    </script>
    <style>
        .label .label-text{font-weight:600}
    </style>
    </head>
<body class="min-h-screen bg-base-200">
    <div class="navbar bg-base-100 shadow">
        <div class="flex-1 px-4 text-xl font-bold">Kemco D365 Imports</div>
        <a class="btn btn-ghost" href="/">Home</a>
    </div>

    <div class="container mx-auto p-4">
        <div class="card bg-base-100 shadow">
            <div class="card-body">
                <h2 class="card-title">D365 Generator</h2>

                <form method="post" class="mb-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                    {% csrf_token %}
                    <label class="form-control">
                        <div class="label"><span class="label-text">Job #</span></div>
                        <input name="job_number" value="{{ job_number|default:'' }}" required class="input input-bordered" placeholder="e.g. 35284" />
                    </label>
                    <label class="form-control">
                        <div class="label"><span class="label-text">Job Name</span></div>
                        <input name="job_name" value="{{ job_name|default:'' }}" class="input input-bordered" placeholder="Optional" />
                    </label>
                    <!-- Section Toggles -->
                    <div class="card bg-base-100 shadow-xl mb-4">
                        <div class="card-body p-4">
                            <h3 class="card-title text-sm">Section Selection</h3>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="toggle_heater" class="checkbox checkbox-primary" {% if 'heater' in selected_sections %}checked{% endif %}>
                                    <span class="text-sm">Heater</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="toggle_tank" class="checkbox checkbox-primary" {% if 'tank' in selected_sections %}checked{% endif %}>
                                    <span class="text-sm">Tank</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="toggle_pump" class="checkbox checkbox-primary" {% if 'pump' in selected_sections %}checked{% endif %}>
                                    <span class="text-sm">Pump</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-end gap-2">
                        <button type="button" onclick="submitGenerateSelected()" class="btn btn-primary">Generate Selected</button>
                        <button type="button" onclick="printSelectedSections()" class="btn btn-accent">Print Selected</button>
                        <button type="button" onclick="draftPrecutEmail()" class="btn btn-secondary">Draft Precut P/N Email</button>
                    </div>
                </form>

                <div role="tablist" class="tabs">
                    <a class="tab tab-active">Import Heater</a>
                    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-4">
                        <form method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {% csrf_token %}
                            <input type="hidden" name="job_number" value="{{ job_number|default:'' }}" />
                            <input type="hidden" name="heater_submit" value="1" />
                            <label class="form-control">
                                <div class="label"><span class="label-text">Dash #</span></div>
                                <input name="heater_dash_number" value="{{ heater_dash_value|default:'01' }}" class="input input-bordered" />
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Material</span></div>
                                <select name="heater_material" class="select select-bordered">
                                    {% for x in heater_materials %}<option value="{{ x.code }}" {% if heater_initial and heater_initial.material == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Model</span></div>
                                <select name="heater_model" class="select select-bordered">
                                    {% for x in heater_models %}<option value="{{ x.code }}" {% if heater_initial and heater_initial.heater_model == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Heater Diameter</span></div>
                                <select name="heater_diameter" class="select select-bordered">
                                    {% for x in heater_diameters %}<option value="{{ x.diameter_inch }}" {% if heater_initial and heater_initial.heater_diameter == x.diameter_inch %}selected{% endif %}>{{ x.diameter_inch }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Heater Height (ft)</span></div>
                                <select name="heater_height" class="select select-bordered">
                                    {% for x in heater_heights %}<option value="{{ x.height_ft }}" {% if heater_initial and heater_initial.heater_height == x.height_ft %}selected{% endif %}>{{ x.height_ft }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Stack Diameter</span></div>
                                <select name="stack_diameter" class="select select-bordered">
                                    {% for x in stack_diameters %}<option value="{{ x.diameter_inch }}" {% if heater_initial and heater_initial.stack_diameter == x.diameter_inch %}selected{% endif %}>{{ x.diameter_inch }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Stack Height (ft)</span></div>
                                <select name="stack_height" class="select select-bordered">
                                    <option value="">â€”</option>
                                    {% for x in stack_heights %}<option value="{{ x.height_ft }}" {% if heater_initial and heater_initial.stack_height == x.height_ft %}selected{% endif %}>{{ x.height_ft }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Flange Inlet (in)</span></div>
                                <select name="flange_inlet" class="select select-bordered">
                                    {% for x in flange_inlets %}<option value="{{ x.size_inch }}" {% if heater_initial and heater_initial.flange_inlet == x.size_inch %}selected{% endif %}>{{ x.size_inch }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Gas Train Size (in)</span></div>
                                <select name="gas_train_size" class="select select-bordered">
                                    {% for x in gas_train_sizes %}<option value="{{ x.size_inch }}" {% if heater_initial and heater_initial.gas_train_size == x.size_inch %}selected{% endif %}>{{ x.size_inch }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Gas Train Mount</span></div>
                                <select name="gas_train_mount" class="select select-bordered">
                                    {% for x in gas_train_mounts %}<option value="{{ x.code }}" {% if heater_initial and heater_initial.gas_train_mount == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">BTU (MMBTU)</span></div>
                                <select name="btu" class="select select-bordered">
                                    {% for x in btu_ratings %}<option value="{{ x.value_mmbtu }}" {% if heater_initial and heater_initial.btu == x.value_mmbtu %}selected{% endif %}>{{ x.value_mmbtu }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Hand</span></div>
                                <select name="heater_hand" class="select select-bordered">
                                    {% for x in heater_hands %}<option value="{{ x.code }}" {% if heater_initial and heater_initial.hand == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Heater A/B</span></div>
                                <select name="heater_ab" class="select select-bordered">
                                    {% for x in heater_ab_list %}<option value="{{ x.code }}" {% if heater_initial and heater_initial.heater_ab == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <div class="md:col-span-3"><button class="btn btn-primary">Generate Heater</button></div>
                        </form>

                        {% if heater_items %}
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-semibold">Heater Generated Items</h3>
                                <button class="btn btn-sm" onclick="copyAll('heater-table')">Copy All</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table id="heater-table" class="table table-zebra w-full">
                                    <thead><tr><th>Item Number</th><th>Description</th><th>BOM</th><th>Template</th><th>Type</th><th></th></tr></thead>
                                    <tbody>
                                        {% for r in heater_items %}
                                        <tr>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.item_number }}')">{{ r.item_number }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.description }}')">{{ r.description }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.bom }}')">{{ r.bom }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.template }}')">{{ r.template }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.product_type }}')">{{ r.product_type }}</button></td>
                                            <td><button class="btn btn-xs" onclick="copyRow(this)" type="button">Copy</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <a class="tab">Import Tank</a>
                    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-4">
                        <form method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {% csrf_token %}
                            <input type="hidden" name="job_number" value="{{ job_number|default:'' }}" />
                            <input type="hidden" name="tank_submit" value="1" />
                            <label class="form-control">
                                <div class="label"><span class="label-text">Dash #</span></div>
                                <input name="tank_dash_number" value="{{ tank_dash_value|default:'01' }}" class="input input-bordered" />
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Material</span></div>
                                <select name="tank_material" class="select select-bordered">
                                    {% for x in tank_materials %}<option value="{{ x.code }}" {% if tank_initial and tank_initial.material == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Type</span></div>
                                <select name="tank_type" class="select select-bordered">
                                    {% for x in tank_types %}<option value="{{ x.code }}" {% if tank_initial and tank_initial.tank_type == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Diameter (in)</span></div>
                                <select name="tank_diameter" class="select select-bordered">
                                    {% for x in tank_diameters %}<option value="{{ x.diameter_inch }}" {% if tank_initial and tank_initial.tank_diameter == x.diameter_inch %}selected{% endif %}>{{ x.diameter_inch }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Height (ft)</span></div>
                                <select name="tank_height" class="select select-bordered">
                                    {% for x in tank_heights %}<option value="{{ x.height_ft }}" {% if tank_initial and tank_initial.tank_height == x.height_ft %}selected{% endif %}>{{ x.height_ft }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Tank Inches</span></div>
                                <input name="tank_inches" type="number" step="0.01" value="{{ tank_initial.tank_inches|default:'' }}" class="input input-bordered" placeholder="Tank height in inches" />
                            </label>
                            <div class="md:col-span-3"><button class="btn btn-primary">Generate Tank</button></div>
                        </form>

                        {% if tank_items %}
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-semibold">Tank Generated Items</h3>
                                <button class="btn btn-sm" onclick="copyAll('tank-table')">Copy All</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table id="tank-table" class="table table-zebra w-full">
                                    <thead><tr><th>Item Number</th><th>Description</th><th>BOM</th><th>Template</th><th>Type</th><th></th></tr></thead>
                                    <tbody>
                                        {% for r in tank_items %}
                                        <tr>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.item_number }}')">{{ r.item_number }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.description }}')">{{ r.description }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.bom }}')">{{ r.bom }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.template }}')">{{ r.template }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.product_type }}')">{{ r.product_type }}</button></td>
                                            <td><button class="btn btn-xs" onclick="copyRow(this)" type="button">Copy</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <a class="tab">Import Pump</a>
                    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-4">
                        <form method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {% csrf_token %}
                            <input type="hidden" name="job_number" value="{{ job_number|default:'' }}" />
                            <input type="hidden" name="pump_submit" value="1" />
                            <label class="form-control">
                                <div class="label"><span class="label-text">Dash #</span></div>
                                <input name="pump_dash_number" value="{{ pump_dash_value|default:'01' }}" class="input input-bordered" />
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Material</span></div>
                                <select name="pump_material" class="select select-bordered">
                                    {% for x in pump_materials %}<option value="{{ x.code }}" {% if pump_initial and pump_initial.material == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text"># of Pumps</span></div>
                                <select name="pump_type" class="select select-bordered">
                                    {% for x in pump_types %}<option value="{{ x.code }}" {% if pump_initial and pump_initial.pump_type == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Pump Pressure</span></div>
                                <select name="pump_pressure" class="select select-bordered">
                                    {% for x in pump_pressures %}<option value="{{ x.code }}" {% if pump_initial and pump_initial.pump_pressure == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">System Type</span></div>
                                <select name="system_type" class="select select-bordered">
                                    {% for x in system_types %}<option value="{{ x.code }}" {% if pump_initial and pump_initial.system_type == x.code %}selected{% endif %}>{{ x.display_name }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">HP</span></div>
                                <select name="hp" class="select select-bordered">
                                    {% for x in horsepower %}<option value="{{ x.hp }}" {% if pump_initial and pump_initial.hp == x.hp %}selected{% endif %}>{{ x.hp }}</option>{% endfor %}
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label"><span class="label-text">Skid L/W/H (in)</span></div>
                                <div class="join">
                                    <input name="skid_length" value="{{ pump_initial.skid_length|default:'' }}" class="input input-bordered join-item" placeholder="L" />
                                    <input name="skid_width" value="{{ pump_initial.skid_width|default:'' }}" class="input input-bordered join-item" placeholder="W" />
                                    <input name="skid_height" value="{{ pump_initial.skid_height|default:'' }}" class="input input-bordered join-item" placeholder="H" />
                                </div>
                            </label>
                            <div class="md:col-span-3"><button class="btn btn-primary">Generate Pump</button></div>
                        </form>

                        {% if pump_items %}
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-semibold">Pump Generated Items</h3>
                                <button class="btn btn-sm" onclick="copyAll('pump-table')">Copy All</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table id="pump-table" class="table table-zebra w-full">
                                    <thead><tr><th>Item Number</th><th>Description</th><th>BOM</th><th>Template</th><th>Type</th><th></th></tr></thead>
                                    <tbody>
                                        {% for r in pump_items %}
                                        <tr>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.item_number }}')">{{ r.item_number }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.description }}')">{{ r.description }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left font-mono text-xs" onclick="copyToClipboard('{{ r.bom }}')">{{ r.bom }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.template }}')">{{ r.template }}</button></td>
                                            <td><button class="btn btn-ghost btn-sm w-full text-left text-xs" onclick="copyToClipboard('{{ r.product_type }}')">{{ r.product_type }}</button></td>
                                            <td><button class="btn btn-xs" onclick="copyRow(this)" type="button">Copy</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>


